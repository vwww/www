var uttt={TIME_INTERMISSION:3E4,TIME_MOVE:15E3,TIME_MOVE_BLITZ:5E3,lang:!1,langs:{}};
window.addEventListener("load",function(){uttt.lang=uttt.langs.en;for(var a=0;9>a;++a)for(var b=$("uttt-"+a),c=0;3>c;++c)for(var d=0;3>d;++d)b.rows[c].cells[d].onclick=function(){var b=a,e=3*c+d;return function(){uttt.ui.select_square(b,e)}}();$("lobby-button").value=uttt.lang.BTN_READY;$("lobby-status").innerHTML=uttt.lang.WAITING_TITLE_DISCONNECTED;$("lobby-status-small").innerHTML=uttt.lang.WAITING_DISCONNECTED;$("lobby-option-span0").innerHTML=uttt.lang.STATIC_MOD0;$("lobby-option-span1").innerHTML=
uttt.lang.STATIC_MOD1;$("lobby-option-span2").innerHTML=uttt.lang.STATIC_MOD2;$("lobby-option-span3").innerHTML=uttt.lang.STATIC_MOD3;$("mod-name0").innerHTML=uttt.lang.STATIC_MOD0;$("mod-name1").innerHTML=uttt.lang.STATIC_MOD1;$("mod-name2").innerHTML=uttt.lang.STATIC_MOD2;$("mod-name3").innerHTML=uttt.lang.STATIC_MOD3;$("game-btn-disconnect").value=uttt.lang.INGAME_BTN_DISCONNECT;$("game-btn").value=uttt.lang.INGAME_BTN_READY;$("uttt-game").className="hide";$("mod-desc0").innerHTML=$("mod-desc0").innerHTML.replace("STATIC_MOD_DESC0",
uttt.lang.STATIC_MOD_DESC0);$("mod-desc1").innerHTML=$("mod-desc1").innerHTML.replace("STATIC_MOD_DESC1",uttt.lang.STATIC_MOD_DESC1);$("mod-desc2").innerHTML=$("mod-desc2").innerHTML.replace("STATIC_MOD_DESC2",uttt.lang.STATIC_MOD_DESC2);$("mod-desc3").innerHTML=$("mod-desc3").innerHTML.replace("STATIC_MOD_DESC3",uttt.lang.STATIC_MOD_DESC3);console.log("v1")},!1);window.addEventListener("beforeunload",function(){if(gg.net.is_receiving)return"You are disconnecting from the match."});uttt.langs.en={BTN_READY:"I'm Ready!",BTN_UNREADY:"I'm not ready anymore",WAITING_TITLE_DISCONNECTED:"Select options",WAITING_DISCONNECTED:"Click the ready button!",WAITING_TITLE_NOOPPONENT:"Wait for an opponent&hellip;",WAITING_NOOPPONENT:"Ask your friend to join you!",INGAME_TITLE_WAIT:"Intermission&hellip;",INGAME_TITLE_WAIT_TIME:function(a){return"Intermission: "+a+" seconds left"},INGAME_WAITING:"Get ready and click the ready button!",INGAME_READY_LOCAL:"The game is going to begin soon!",INGAME_READY_OPP:"Your opponent is <b>waiting</b> for you!",
INGAME_BTN_DISCONNECT:"Stop Playing",INGAME_BTN_READY:"I'm Ready",INGAME_TITLE_LOCAL:function(a){return"It's your turn! "+a+" seconds left"},INGAME_TITLE_OPP:function(a){return"Wait for the opponent to move&hellip; "+a+" seconds left"},INGAME_TITLE_LEAVE:"No opponent",INGAME_LOCAL:"Make a move!",INGAME_INVALID_MOVE:"Make a different move; that one is invalid.",INGAME_NOT_TURN:"It's not your turn yet!",INGAME_NOT_STARTED:"The game hasn't started yet.",INGAME_OPP:"Wait for the opponent.",INGAME_WIN:"You have <b>won</b> this round!",
INGAME_LOSE:"You have <b>lost</b> this round!",INGAME_TIE:"It's a draw; the board is full.",INGAME_FORFEIT:"Your opponent forfeited this round.",INGAME_FORFEIT_LOCAL:"You have forfeited this round.",INGAME_LEFT:"Your opponent has left the game.",INGAME_BTN_FORFEIT:"Forfeit",STATIC_PLAYERLIST:"Players",STATIC_PLAYERLIST_LOCAL:" (you)",STATIC_MOD:"Modifiers",STATIC_MOD_DESC:"Change the rules!",STATIC_MOD0:"Inverted",STATIC_MOD1:"Quick",STATIC_MOD2:"Blitz",STATIC_MOD3:"Expert",STATIC_MOD_DESC0:"The winner and loser are swapped, but only legal moves may be used.",
STATIC_MOD_DESC1:"Capture one small board to win.",STATIC_MOD_DESC2:"A random move will be made after 5 seconds instead of the regular 15.",STATIC_MOD_DESC3:"Allow all moves; moves are unrestricted.",MOD_LOCAL:"YOU",MOD_OPP:"OPP",MOD_MESSAGE:function(a,b){return"This option is <b>"+a+"</b>"+(b?" because the server picked <b>"+b+"</b> choice.":".")},MOD_MESSAGE_ON:"on",MOD_MESSAGE_OFF:"off",MOD_MESSAGE_LOCAL:"your",MOD_MESSAGE_OPP:"your opponent's"};uttt.ui={lobby_ready:function(){$("lobby-button").disabled=!0;$("lobby-option1").disabled=!0;$("lobby-option2").disabled=!0;$("lobby-option3").disabled=!0;var a=0;$("lobby-option1").checked&&(a=1);$("lobby-option2").checked&&(a|=2);$("lobby-option3").checked&&(a|=4);$("lobby-option4").checked&&(a|=8);uttt.net.connect("n="+encodeURIComponent(gg.nickname.getName())+"&options="+a,function(a){uttt.net.p_id=a[1];uttt.net.g_id=a[2];$("players-local").innerText=a[3];$("players-local-wins").innerText=0;$("players-remote-wins").innerText=
0;a[0]?($("players-remote").innerText=a[4],uttt.game.modifiers=a[5],uttt.ui.ingame_start(a[6],2)):(uttt.game.has_opponent=!1,$("lobby-button").onclick=uttt.ui.lobby_unready,$("lobby-button").disabled=!1,$("lobby-button").value=uttt.lang.BTN_UNREADY,$("lobby-status").innerHTML=uttt.lang.WAITING_TITLE_NOOPPONENT,$("lobby-status-small").innerHTML=uttt.lang.WAITING_NOOPPONENT)})},lobby_unready:function(){$("lobby-button").disabled=!0;uttt.net.leave(function(a){$("lobby-button").onclick=uttt.ui.lobby_ready;
$("lobby-button").disabled=!1;$("lobby-button").value=uttt.lang.BTN_READY;$("lobby-option1").disabled=!1;$("lobby-option2").disabled=!1;$("lobby-option3").disabled=!1;$("lobby-status").innerHTML=uttt.lang.WAITING_TITLE_DISCONNECTED;$("lobby-status-small").innerHTML=uttt.lang.WAITING_DISCONNECTED;$("players-local").innerText=""})},ready:0,ready_time:0,ready_timer:0,update_ready_message:function(a){a&&(uttt.ui.ready_timer&&(clearTimeout(uttt.ui.ready_timer),uttt.ui.ready_timer=0),uttt.ui.ready_time=
(new Date).getTime());if(uttt.ui.ready){var b=uttt.ui.ready_time-(new Date).getTime();3==uttt.ui.ready?(b=((b+(uttt.game.modifiers&4?uttt.TIME_MOVE_BLITZ:uttt.TIME_MOVE))/1E3).toFixed(1),uttt.game.has_turn||uttt.game.moves_next.length?($("uttt-game-status").innerHTML=uttt.lang.INGAME_TITLE_LOCAL(b),a&&($("game-status").innerHTML=uttt.lang.INGAME_LOCAL)):($("uttt-game-status").innerHTML=uttt.lang.INGAME_TITLE_OPP(b),a&&($("game-status").innerHTML=uttt.lang.INGAME_OPP))):(b=((b+uttt.TIME_INTERMISSION)/
1E3).toFixed(1),a&&(1==uttt.ui.ready?$("game-status").innerHTML=uttt.lang.INGAME_READY_LOCAL:$("game-status").innerHTML=uttt.lang.INGAME_READY_OPP),$("uttt-game-status").innerHTML=uttt.lang.INGAME_TITLE_WAIT_TIME(b));uttt.ui.ready_timer=window.setTimeout(uttt.ui.update_ready_message,100)}},ingame_start:function(a,b){uttt.game.reset(!0);$("lobby").className="hide";$("uttt-game").className="";for(var c=0;4>c;++c){var d=uttt.game.modifiers&1<<c?uttt.lang.MOD_MESSAGE_ON:uttt.lang.MOD_MESSAGE_OFF;$("mod-indicator"+
c).innerHTML=(a[c]?a[c]==b?uttt.lang.MOD_LOCAL:uttt.lang.MOD_OPP:"")+"<br/><span>"+d+"</span>";$("mod"+c).innerHTML=uttt.lang.MOD_MESSAGE(d,a[c]?a[c]==b?uttt.lang.MOD_MESSAGE_LOCAL:uttt.lang.MOD_MESSAGE_OPP:"")}uttt.ui.intermission(uttt.lang.INGAME_WAITING)},ingame_ready:function(){$("game-btn").disabled=!0;uttt.net.send("ready",function(a){a[0]&&(a[1]&&(uttt.game.has_turn=a[2],uttt.ui.ready=3),uttt.ui.ready|=1,3==uttt.ui.ready&&uttt.game.reset(),uttt.ui.update_ready_message(!0))})},ingame_forfeit:function(){uttt.net.send("forfeit",
function(a){uttt.ui.intermission(uttt.lang.INGAME_FORFEIT_LOCAL);uttt.ui.win(2)})},ingame_disconnect:function(){uttt.net.leave(function(a){$("lobby").className="";$("uttt-game").className="hide";$("lobby-button").onclick=uttt.ui.lobby_ready;$("lobby-button").disabled=!1;$("lobby-button").value=uttt.lang.BTN_READY;$("lobby-option1").disabled=!1;$("lobby-option2").disabled=!1;$("lobby-option3").disabled=!1;$("lobby-status").innerHTML=uttt.lang.WAITING_TITLE_DISCONNECTED;$("lobby-status-small").innerHTML=
uttt.lang.WAITING_DISCONNECTED;$("players-local").innerText=$("players-remote").innerText=""})},select_square:function(a,b){uttt.game.moves_next.length||uttt.net.send_("move",uttt.net.get_id()+"&b="+a+"&n="+b,function(a){a[0]?uttt.net.received([!0,a[1]]):1==a[1]?$("game-status").innerHTML=uttt.lang.INGAME_INVALID_MOVE:2==a[1]?$("game-status").innerHTML=uttt.lang.INGAME_NOT_TURN:3==a[1]?$("game-status").innerHTML=uttt.lang.INGAME_NOT_STARTED:$("game-status").innerHTML="(unknown move error)"})},intermission:function(a){uttt.ui.ready=
0;$("game-btn").disabled=!1;$("game-btn").value=uttt.lang.INGAME_BTN_READY;$("game-btn").onclick=uttt.ui.ingame_ready;$("uttt-game-status").innerHTML=uttt.lang.INGAME_TITLE_WAIT;$("game-status").innerHTML=a},win:function(a){1==a?$("players-local-wins").innerText=parseInt($("players-local-wins").innerText)+1:2==a&&($("players-remote-wins").innerText=parseInt($("players-remote-wins").innerText)+1)},mark:function(a,b,c){(9==a?$("uttt-"+b):$("uttt-"+a).rows[Math.floor(b/3)].cells[b%3]).className=c?"p"+
c:""},mark_boards:function(a){for(var b=0;9>b;++b){var c=$("uttt-"+b),d=uttt.game.next_board==b||-1==uttt.game.next_board;if(a||"p1"!=c.className&&"p2"!=c.className)c.className=d?"p3":"";for(var g=0;3>g;++g)for(var e=0;3>e;++e){var f=c.rows[g].cells[e];a?f.className="p3":"p1"!=f.className&&"p2"!=f.className&&(d&&uttt.game.canMove(b,3*g+e,uttt.game.has_turn?1:2)?f.className="p3":f.className="")}}}};uttt.net={p_id:0,g_id:0,get_id:function(){return"g="+uttt.net.g_id+"&p="+uttt.net.p_id},send_:function(a,b,c){return gg.net.send("uttt/"+a,b,c)},send:function(a,b){return uttt.net.send_(a,uttt.net.get_id(),b)},connect:function(a,b){uttt.net.send_("connect",a,function(a){b(a);gg.net.receive("uttt/poll",uttt.net.get_id(),uttt.net.received)})},leave:function(a){gg.net.receive_stop();uttt.net.send("disconnect",a)},received:function(a){if(a[0]){a=a[1];for(var b=0;b<a.length;++b){var c=a[b];switch(c[0]){case "join":$("players-remote").innerText=
c[1];uttt.game.modifiers=c[2];uttt.ui.ingame_start(c[3],1);break;case "start":uttt.ui.ready=3,uttt.game.has_turn=c[1];case "ready":uttt.ui.ready|=2;3==uttt.ui.ready&&uttt.game.reset();uttt.ui.update_ready_message(!0);break;case "move":uttt.game.moves_next.length?uttt.game.moves_next.unshift([c[1],c[2],uttt.game.has_turn?1:2]):(uttt.game.move(c[1],c[2],uttt.game.has_turn?1:2),uttt.game.moves_previous.push([c[1],c[2],uttt.game.has_turn?1:2]));uttt.ui.update_ready_message(!0);break;case "win":uttt.ui.intermission(uttt.game.has_turn?
uttt.lang.INGAME_LOSE:uttt.lang.INGAME_WIN);uttt.ui.win(uttt.game.has_turn?2:1);break;case "forfeit":uttt.ui.intermission(uttt.lang.INGAME_FORFEIT);uttt.ui.win(1);break;case "tie":uttt.ui.intermission(uttt.lang.INGAME_TIE);uttt.ui.win(3);break;case "leave":uttt.ui.ready=0,gg.net.receive_stop(),$("game-btn").disabled=!0,$("uttt-game-status").innerHTML=uttt.lang.INGAME_TITLE_LEAVE,$("game-status").innerHTML=uttt.lang.INGAME_LEFT}}}}};uttt.game={moves_previous:[],moves_next:[],moves_position:0,moves_maximum:0,modifiers:0,next_board:-1,has_turn:!1,has_opponent:!1,boards:[0,0,0,0,0,0,0,0,0],reset:function(a){uttt.game.moves_previous=[];uttt.game.moves_next=[];uttt.game.moves_position=0;uttt.game.moves_maximum=0;uttt.game.next_board=-1;uttt.game.boards=[0,0,0,0,0,0,0,0,0];uttt.ui.mark_boards(!0);a||($("game-btn").disabled=!1,$("game-btn").value=uttt.lang.INGAME_BTN_FORFEIT,$("game-btn").onclick=uttt.ui.ingame_forfeit)},canMove:function(a,
b,c){if(uttt.game.boards[a]&3<<(b<<1))return!1;if(!(uttt.game.modifiers&8))if(uttt.game.modifiers&1){if(uttt.game.winner(uttt.game.boards[a]|1<<(b<<1)+c-1)&&(uttt.game.modifiers&2||uttt.game.winner(uttt.game.boards[9]|1<<(a<<1)+c-1)))return!1}else if(uttt.game.modifiers&2){var d=uttt.game.boards[b];a==b&&(d|=1<<(b<<1)+c-1);if(uttt.game.nearWin(d,c^3))return!1}return!0},check_patterns:function(a,b,c){"undefined"==typeof c&&(c=b);for(var d=0;d<b.length;++d)if((a&c[d])==b[d])return!0;return!1},hasSpace:function(a){return uttt.game.check_patterns(~a,
uttt.patterns.empty_patterns)},nearWin:function(a,b){return uttt.game.check_patterns(a,1==b?uttt.patterns.near_win_1:uttt.patterns.near_win_2,uttt.patterns.near_win_mask)},winner:function(a){return uttt.game.check_patterns(a,uttt.patterns.win_patterns_1)?1:uttt.game.check_patterns(a,uttt.patterns.win_patterns_2)?2:0},move:function(a,b,c){++uttt.game.moves_position;uttt.game.has_turn^=1;uttt.game.boards[a]|=1<<(b<<1)+c-1;uttt.ui.mark(a,b,c);uttt.game.winner(uttt.game.boards[b])||!uttt.game.hasSpace(uttt.game.boards[b])?
uttt.game.next_board=-1:uttt.game.next_board=b;uttt.game.winner(uttt.game.boards[a])&&(uttt.game.boards[9]|=1<<(b<<1)+c-1,uttt.ui.mark(9,a,c));uttt.ui.mark_boards()},undo:function(a,b){--uttt.game.moves_position;uttt.game.has_turn^=1;uttt.game.moves_position&&!uttt.game.winner(uttt.game.boards[a])&&uttt.game.hasSpace(uttt.game.boards[a])?uttt.game.next_board=a:uttt.game.next_board=-1;uttt.game.boards[a]&=~(3<<(b<<1));uttt.ui.mark(a,b,0);uttt.game.winner(uttt.game.boards[a])||(uttt.game.boards[9]&=
~(3<<(b<<1)),uttt.ui.mark(9,a,0));uttt.ui.mark_boards()}};uttt.replay={back:function(){uttt.game.moves_position&&(uttt.replay.rewind_one(),uttt.replay.recalc_bar())},forward:function(){uttt.game.moves_next.length&&(uttt.replay.forward_one(),uttt.replay.recalc_bar())},recalc_bar:function(){var a=uttt.game.moves_position,b=a+uttt.game.moves_next.length;b||(a=b=1);$("progress").style.width=100*a/b+"%"},forward_one:function(){var a=uttt.game.moves_next.pop();uttt.game.move(a[0],a[1],a[2]);uttt.game.moves_previous.push(a)},rewind_one:function(){var a=uttt.game.moves_previous.pop();
uttt.game.undo(a[0],a[1]);uttt.game.moves_next.push(a)},forward_all:function(){for(;uttt.game.moves_next.length;)forward_one()},rewind_all:function(){for(;uttt.game.moves_previous.length;)rewind_one()}};uttt.patterns={empty_patterns:[3,12,48,192,768,3072,12288,49152,196608],win_patterns_1:[86016,1344,21,66576,16644,4161,65793,4368],win_patterns_2:[172032,2688,42,133152,33288,8322,131586,8736],near_win_mask:[258048,258048,258048,4032,4032,4032,63,63,63,199728,199728,199728,49932,49932,49932,12483,12483,12483,197379,197379,197379,13104,13104,13104],near_win_1:[20480,69632,81920,320,1088,1280,5,17,20,1040,65552,66560,260,16388,16640,65,4097,4160,257,65537,65792,272,4112,4352],near_win_2:[40960,139264,
163840,640,2176,2560,10,34,40,2080,131104,133120,520,32776,33280,130,8194,8320,514,131074,131584,544,8224,8704]};